<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NanoBanana — Futuristic AI Generator</title>
  <style>
    :root {
      --accent:#6a3ad6;
      --accent-light:#8f63ff;
      --muted:#f3f4f6;
      --bg-gradient: linear-gradient(135deg,#6a3ad6,#1e3afc);
    }
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,'Helvetica Neue',Arial;margin:0;background:var(--bg-gradient);color:#fff;}
    .wrap{max-width:980px;margin:18px auto;padding:16px}
    header{display:flex;gap:12px;align-items:center}
    h1{font-size:20px;margin:0;font-weight:600;text-shadow:0 0 6px rgba(0,0,0,0.3)}
    .card{background:rgba(255,255,255,0.05);backdrop-filter:blur(12px);border-radius:12px;padding:16px;box-shadow:0 6px 18px rgba(0,0,0,0.3);margin-top:12px}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    label{font-size:13px}
    input[type=file]{display:block}
    textarea{width:100%;min-height:84px;border-radius:8px;border:1px solid rgba(255,255,255,0.3);padding:8px;background:rgba(255,255,255,0.05);color:#fff}
    button{background:var(--accent);color:white;border:0;padding:10px 14px;border-radius:8px;font-weight:600;cursor:pointer;box-shadow:0 0 12px var(--accent-light)}
    button:hover{box-shadow:0 0 18px var(--accent-light)}
    .gallery{display:flex;flex-wrap:wrap;gap:10px;margin-top:12px}
    .thumb{width:150px;height:150px;object-fit:cover;border-radius:8px;cursor:pointer;border:2px solid rgba(255,255,255,0.2)}
    .thumb:hover{border-color:var(--accent-light)}
    .meta{font-size:12px;color:rgba(255,255,255,0.7);margin-top:6px}
    .small{font-size:12px;color:rgba(255,255,255,0.6)}
    .controls{display:flex;gap:8px;align-items:center}
    .loader{display:inline-block;width:18px;height:18px;border-radius:50%;border:3px solid rgba(255,255,255,0.3);border-top-color:rgba(255,255,255,0.9);animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}
    .preset-chips{display:flex;overflow-x:auto;gap:8px;margin-top:8px;padding-bottom:4px}
    .chip{padding:6px 12px;border-radius:16px;background:rgba(255,255,255,0.1);white-space:nowrap;cursor:pointer;transition:0.2s}
    .chip:hover{background:var(--accent-light);color:#fff;transform:scale(1.05)}
    footer{font-size:12px;color:rgba(255,255,255,0.5);margin-top:18px}
    @media (max-width:520px){.thumb{width:120px;height:120px}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>NanoBanana — Futuristic AI Image Generator</h1>
    </header>

    <div class="card">
      <div class="row">
        <div style="flex:1;min-width:180px">
          <label class="small">Upload reference image:</label>
          <input id="file" type="file" accept="image/*" />
          <div class="meta">Max 5–10MB recommended.</div>
        </div>

        <div style="flex:2;min-width:200px">
          <label class="small">Prompt:</label>
          <textarea id="prompt" placeholder="Describe edits or style..."></textarea>
          <div class="preset-chips" id="presets">
            <div class="chip">Realistic</div>
            <div class="chip">Anime</div>
            <div class="chip">3D</div>
            <div class="chip">Pixar</div>
            <div class="chip">Branding</div>
            <div class="chip">Cartoon</div>
            <div class="chip">Fashion</div>
          </div>
        </div>
      </div>

      <div style="margin-top:12px;display:flex;gap:8px;align-items:center">
        <div class="controls">
          <button id="go">Generate</button>
          <div id="status" style="margin-left:8px"></div>
        </div>
        <div style="margin-left:auto" class="small">Powered by Gemini API</div>
      </div>
    </div>

    <div class="card" id="previewBox" style="display:none">
      <div class="meta">Gallery (tap to download)</div>
      <div class="gallery" id="gallery"></div>
    </div>

    <footer>Upload an image, type prompt or use a preset, tap Generate, and enjoy your AI creations!</footer>
  </div>

  <script>
    const fileInput = document.getElementById('file');
    const promptEl = document.getElementById('prompt');
    const goBtn = document.getElementById('go');
    const gallery = document.getElementById('gallery');
    const previewBox = document.getElementById('previewBox');
    const status = document.getElementById('status');
    const presets = document.getElementById('presets');

    // Add preset click to append prompt
    presets.addEventListener('click', e => {
      if(e.target.classList.contains('chip')){
        promptEl.value = e.target.textContent + ' ' + promptEl.value;
      }
    });

    function readFileAsDataURL(file){
      return new Promise((res, rej)=>{
        const r = new FileReader();
        r.onload = ()=>res(r.result);
        r.onerror = rej;
        r.readAsDataURL(file);
      });
    }

    async function postGenerate({imageDataUrl, prompt, num=3, size=1024}){
      const payload = { image_b64: imageDataUrl, prompt, num_images: Number(num), size };
      const resp = await fetch('/api/generate', {
        method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload)
      });
      if(!resp.ok) throw new Error(await resp.text());
      return resp.json();
    }

    async function showStatus(text,busy=false){
      status.innerHTML='';
      if(busy){
        const l=document.createElement('span'); l.className='loader'; status.appendChild(l);
      }
      const t=document.createElement('span'); t.style.marginLeft='8px'; t.textContent=text; status.appendChild(t);
    }

    async function saveHistory(images){
      let history = JSON.parse(localStorage.getItem('nanobanana_history')||'[]');
      history = history.concat(images);
      localStorage.setItem('nanobanana_history', JSON.stringify(history.slice(-50)));
    }

    goBtn.addEventListener('click', async ()=>{
      const f = fileInput.files[0];
      const prompt = promptEl.value.trim();
      if(!f || !prompt){ alert('Provide image and prompt.'); return; }

      try{
        await showStatus('Generating...', true);
        const dataUrl = await readFileAsDataURL(f);
        const res = await postGenerate({imageDataUrl:dataUrl, prompt});
        gallery.innerHTML='';
        (res.images||[]).forEach((b64,idx)=>{
          const img=document.createElement('img');
          img.src='data:image/png;base64,'+b64;
          img.className='thumb';
          img.title='Tap to download';
          img.onclick=()=>{const a=document.createElement('a'); a.href=img.src; a.download=`nanobanana_${Date.now()}_${idx}.png`; a.click();}
          gallery.appendChild(img);
        });
        if(res.images && res.images.length) previewBox.style.display='block';
        await saveHistory(res.images||[]);
        await showStatus('Done!', false);
      }catch(err){ console.error(err); alert('Failed: '+(err.message||err)); await showStatus('Error', false);}
    });
  </script>
</body>
</html>
